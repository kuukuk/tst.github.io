<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>GPT Spracheingabe mit Pause</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    button { font-size: 1.2rem; padding: 0.5rem 1rem; }
    #transcript, #response { margin-top: 1rem; white-space: pre-wrap; }
  </style>
</head>
<body>

<h2>ðŸŽ¤ GPT Sprachsteuerung mit Pauseerkennung</h2>
<button id="startBtn">Spracheingabe starten</button>
<div id="transcript">ðŸ—£ Du: </div>
<div id="response">ðŸ¤– GPT: </div>

<script>
  const OPENAI_API_KEY = "DEIN_API_KEY_HIER"; // Hier API-Key eintragen
  const recognition = new webkitSpeechRecognition();

  recognition.lang = "de-DE";
  recognition.continuous = true; // dauerhaft zuhÃ¶ren
  recognition.interimResults = true; // Zwischenresultate anzeigen

  let finalTranscript = "";
  let pauseTimeout = null;

  function sendToChatGPT(text) {
    document.getElementById("response").textContent = "ðŸ¤– GPT: Warte auf Antwort...";
    fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + OPENAI_API_KEY
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: text }]
      })
    })
      .then(res => res.json())
      .then(data => {
        const answer = data.choices?.[0]?.message?.content || "Keine Antwort erhalten.";
        document.getElementById("response").textContent = "ðŸ¤– GPT: " + answer;
      })
      .catch(err => {
        document.getElementById("response").textContent = "Fehler: " + err.message;
      });
  }

  recognition.onresult = event => {
    let interimTranscript = "";
    for (let i = event.resultIndex; i < event.results.length; i++) {
      if (event.results[i].isFinal) {
        finalTranscript += event.results[i][0].transcript + " ";
      } else {
        interimTranscript += event.results[i][0].transcript;
      }
    }
    document.getElementById("transcript").textContent = "ðŸ—£ Du: " + finalTranscript + interimTranscript;

    // Reset Timer bei jedem Ergebnis (auch Zwischenresultat)
    clearTimeout(pauseTimeout);
    pauseTimeout = setTimeout(() => {
      if(finalTranscript.trim().length > 0){
        sendToChatGPT(finalTranscript.trim());
        finalTranscript = ""; // Reset nach Absenden
      }
    }, 5000); // 5 Sekunden Pause
  };

  recognition.onerror = event => {
    console.error("Speech recognition error", event.error);
  };

  recognition.onend = () => {
    // Automatisch neu starten, damit kontinuierlich gelauscht wird
    recognition.start();
  };

  document.getElementById("startBtn").onclick = () => {
    finalTranscript = "";
    document.getElementById("transcript").textContent = "ðŸ—£ Du: ";
    document.getElementById("response").textContent = "ðŸ¤– GPT: ";
    recognition.start();
  };
</script>

</body>
</html>
